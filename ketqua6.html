<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>L·ªùi Y√™u Th∆∞∆°ng M∆∞·ª£t KH√îNG XOAY</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body { margin:0; padding:0; overflow:hidden; background:#000; height:100%; }
    canvas { display: block; }
  </style>
</head>
<body>

<canvas id="scene"></canvas>
<audio id="sound" loop>
  <source src="maihongnhan.mp3" type="audio/mpeg" />
</audio>

<script>
const canvas = document.getElementById('scene');
const ctx = canvas.getContext('2d');
function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
resize(); window.addEventListener('resize', resize);

const audio = document.getElementById('sound');
document.addEventListener("click", () => audio.play(), { once: true });
document.addEventListener("touchstart", () => audio.play(), { once: true });

const params = new URLSearchParams(window.location.search);
const customText = decodeURIComponent(params.get('text') || '');
const customMusic = decodeURIComponent(params.get('music') || '');
const customImages = JSON.parse(localStorage.getItem('selectedImages') || '[]');
if (customMusic) {
  audio.querySelector('source').src = customMusic;
  audio.load();
}

const texts = ["Gi√≥"];
const icons = ["üéÇ","üéâ","üíñ","üåü","üíê","üéÅ","‚ú®","üíù"];
if (customText) {
  const lines = customText.split(/\n+/).map(l=>l.trim()).filter(l=>l);
  texts.unshift(...lines);
}
const images = [];
customImages.forEach(src => { const img = new Image(); img.src = src; images.push(img); });

const particles = [];
const sparkles = [];
const MAX_PARTICLES = 50;

function spawnParticle() {
  if (particles.length >= MAX_PARTICLES) return;
  const r = Math.random();
  if (r < 0.4) {
    particles.push({
      type:'text',
      value: texts[Math.floor(Math.random()*texts.length)],
      x: Math.random()*canvas.width,
      y: -50,
      speed: 2 + Math.random()*2,
      size: 20 + Math.random()*10,
      hue: Math.random()*360
    });
  } else if (r < 0.8) {
    particles.push({
      type:'icon',
      value: icons[Math.floor(Math.random()*icons.length)],
      x: Math.random()*canvas.width,
      y: -50,
      speed: 2 + Math.random()*2,
      size: 24 + Math.random()*10
    });
  } else if (images.length) {
    particles.push({
      type:'image',
      value: images[Math.floor(Math.random()*images.length)],
      x: Math.random()*canvas.width,
      y: -50,
      speed: 2 + Math.random()*2,
      size: 40 + Math.random()*20
    });
  }
}

function spawnSparkle() {
  sparkles.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    size: 2 + Math.random()*2,
    alpha: Math.random(),
    life: 200 + Math.random()*200
  });
}
for (let i=0; i<80; i++) spawnSparkle();

function loop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Sparkle n·ªÅn
  sparkles.forEach((s,i)=>{
    ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
    ctx.fillRect(s.x,s.y,s.size,s.size);
    s.life--;
    if (s.life<0) { sparkles.splice(i,1); spawnSparkle(); }
  });

  // H·∫°t r∆°i th·∫≥ng
  particles.forEach((p,i)=>{
    p.y += p.speed;
    ctx.save();
    ctx.translate(p.x, p.y);

    if (p.type==='text') {
      p.hue += 1;
      ctx.fillStyle = `hsl(${p.hue},100%,50%)`;
      ctx.shadowColor = ctx.fillStyle;
      ctx.shadowBlur = 10;
      ctx.font = `${p.size}px Poppins`;
      ctx.fillText(p.value, 0,0);
    } else if (p.type==='icon') {
      ctx.font = `${p.size}px Poppins`;
      ctx.fillStyle = "#fff";
      ctx.fillText(p.value, 0,0);
    } else if (p.type==='image') {
      ctx.drawImage(p.value, -p.size/2, -p.size/2, p.size, p.size);
    }
    ctx.restore();

    if (p.y > canvas.height + 50) particles.splice(i,1);
  });

  if (particles.length < MAX_PARTICLES && Math.random()<0.7) spawnParticle();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
